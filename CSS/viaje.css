/* =========================================================
   VIAJE — Planetarium 1:01–2:25
   Estilo: Jazz Noir Minimal (elegante, cinematográfico)
   Capas: bgCanvas (fondo) + fxCanvas (rayos/notas/fugaces)
   Estados: .v-active, .v-ramp-1, .v-preclimax, .v-boost-stars
   Tokens: --v-bright, --v-zoom, --v-roll, --v-speed
   ========================================================= */

/* -----------------------------
   0) RESET & BASE TIPOGRAFÍA
   ----------------------------- */
* { box-sizing: border-box; }
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  background: #0b0f1d; /* Midnight de fondo de seguridad */
  color: #f2efe9;      /* Ivory */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
body {
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI",
               Roboto, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji",
               "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
  overflow: hidden; /* Evitar scroll durante la escena */
}

/* Ocultos accesibles */
.sr-only {
  position: absolute !important;
  width: 1px !important; height: 1px !important;
  padding: 0 !important; margin: -1px !important;
  overflow: hidden !important; clip: rect(0,0,0,0) !important;
  white-space: nowrap !important; border: 0 !important;
}

/* -----------------------------
   1) PALETA & TOKENS (CSS Vars)
   ----------------------------- */
:root {
  /* Paleta */
  --midnight: #0b0f1d;
  --royal:    #243b6b;
  --gold:     #ffda6b;
  --lav:      #d7c8ff;
  --ivory:    #f2efe9;

  /* Tokens de look & dinámica */
  --v-bright: 1;        /* brillo global base (1.00 → 1.06 en preclímax) */
  --v-zoom:   1;        /* zoom global base (1.00 → 1.045 en 2:20) */
  --v-roll:   0deg;     /* roll global leve (±0.4deg, 0 al final) */
  --v-speed:  1;        /* escala de velocidad para animaciones canvas */

  /* Opacidades/Intensidades de overlays */
  --v-vignette: 1;      /* 0–1 intensidad de viñeta */
  --v-grain:   0.08;    /* 0–0.15 grano fílmico */
  --v-foco:    0.85;    /* 0–1 fuerza del foco dorado */
  --v-bokeh:   0.9;     /* 0–1 intensidad bokeh overlay (si se usa) */

  /* Tipografía “susurros” */
  --whisper-size: clamp(0.8rem, 1.2vw + .5rem, 1.2rem);
  --whisper-track: 0.04em; /* tracking +4 */
  --whisper-color: var(--ivory);

  /* Botón */
  --btn-bg: linear-gradient(180deg, #1b2442, #0f1630);
  --btn-fg: var(--ivory);
  --btn-ring: #3b5fb4;
}

/* -----------------------------
   2) LAYOUT DE ESCENA
   ----------------------------- */
.stage {
  position: relative;
  width: 100vw; height: 100vh;
  overflow: hidden;
  /* Fondo de seguridad (degradado) por si canvas tarda en pintar */
  background:
    radial-gradient(120% 85% at 50% 15%,
      rgba(36,59,107,0.35) 0%, rgba(11,15,29,0.0) 45%) ,
    radial-gradient(120% 85% at 50% 85%,
      rgba(255,218,107,0.10) 0%, rgba(11,15,29,0.0) 55%),
    var(--midnight);
  /* Post-proceso global (aplicado a toda la escena) */
  filter: brightness(var(--v-bright)) saturate(1.02) contrast(1.04);
  transform: scale(var(--v-zoom)) rotate(var(--v-roll));
  transform-origin: 50% 50%;
  transition:
    filter 400ms cubic-bezier(.22,.61,.36,1),
    transform 600ms cubic-bezier(.22,.61,.36,1);
}

/* Capas canvas (pintadas por JS) */
#bgCanvas, #fxCanvas {
  position: absolute; inset: 0;
  width: 100%; height: 100%;
  display: block;
}
#bgCanvas { z-index: 0; }
#fxCanvas { z-index: 2; pointer-events: none; }

/* -----------------------------
   3) OVERLAYS CINEMATOGRÁFICOS
   ----------------------------- */
/* Viñeta (oscurece bordes para “cine”) */
.v-vignette::after {
  content: "";
  position: absolute; inset: 0;
  pointer-events: none;
  mix-blend-mode: multiply;
  opacity: calc(0.75 * var(--v-vignette));
  background:
    radial-gradient(ellipse 120% 85% at 50% 50%,
      rgba(0,0,0,0) 50%, rgba(0,0,0,0.35) 75%, rgba(0,0,0,0.62) 100%);
}
.stage.v-vignette::after { z-index: 3; }

/* Foco dorado elíptico desde arriba (abre 10%→25%) */
.foco-dorado {
  position: absolute; inset: 0;
  z-index: 1;
  pointer-events: none;
  opacity: var(--v-foco);
  background:
    radial-gradient(120% 55% at 50% -15%,
      rgba(255,218,107,0.25) 0%,
      rgba(255,218,107,0.14) 22%,
      rgba(255,218,107,0.08) 35%,
      rgba(255,218,107,0.00) 60%);
  transition: opacity 600ms ease, transform 1200ms cubic-bezier(.22,.61,.36,1);
  transform-origin: 50% 0%;
}

/* Grano fílmico sutil (procedural ligero) */
.grain-overlay {
  position: absolute; inset: 0;
  z-index: 4; pointer-events: none;
  opacity: var(--v-grain);
  mix-blend-mode: overlay;
  background-image:
    radial-gradient(1.2px 1.2px at 8% 12%, rgba(255,255,255,0.12) 20%, transparent 21%),
    radial-gradient(1.4px 1.4px at 82% 33%, rgba(255,255,255,0.08) 20%, transparent 21%),
    radial-gradient(1.1px 1.1px at 41% 77%, rgba(255,255,255,0.10) 20%, transparent 21%),
    radial-gradient(1.3px 1.3px at 63% 58%, rgba(255,255,255,0.06) 20%, transparent 21%),
    radial-gradient(1.2px 1.2px at 25% 45%, rgba(0,0,0,0.25) 20%, transparent 21%),
    radial-gradient(1.3px 1.3px at 70% 20%, rgba(0,0,0,0.18) 20%, transparent 21%);
  background-size: 140px 140px, 160px 160px, 150px 150px, 180px 180px, 200px 200px, 220px 220px;
  animation: grainShift 6s steps(60) infinite;
}
@keyframes grainShift {
  0%   { transform: translate(0,0); }
  50%  { transform: translate(-1.5%, 1%); }
  100% { transform: translate(0,0); }
}

/* Flash corto (100–130 ms) sincronizado con cues 1:42, 1:48, 2:23) */
.flash {
  position: absolute; inset: 0; z-index: 5; pointer-events: none;
  opacity: 0; transition: opacity 120ms ease-out;
  background:
    radial-gradient(65% 50% at 50% 50%,
      rgba(255,245,225,0.55), rgba(255,218,107,0.45) 32%,
      rgba(255,218,107,0.15) 52%, rgba(255,218,107,0.0) 70%);
  mix-blend-mode: screen;
}
.flash.is-on { opacity: 1; }

/* Susurros (tipografía breve, 1–2 palabras) */
.v-whisper {
  position: absolute; left: 50%; top: 14%;
  transform: translate(-50%, -50%);
  font-size: var(--whisper-size);
  font-variant-caps: all-small-caps;
  letter-spacing: var(--whisper-track);
  color: var(--whisper-color);
  text-shadow:
    0 0 12px rgba(0,0,0,0.40),
    0 0 28px rgba(0,0,0,0.55),
    0 0 42px rgba(36,59,107,0.35); /* Royal */
  opacity: 0; transition: opacity 450ms ease;
  z-index: 6; pointer-events: none; user-select: none;
}
.v-whisper.show { opacity: 0.92; }

/* Notas/estrellitas decorativas en tap/click (JS inyecta elementos) */
.tap-note {
  position: absolute;
  width: 10px; height: 10px; border-radius: 50%;
  background: radial-gradient(circle at 40% 40%, var(--gold), rgba(255,218,107,0.0) 70%);
  box-shadow:
    0 0 8px rgba(255,218,107,0.85),
    0 0 18px rgba(215,200,255,0.60), /* Lavanda halo */
    0 0 32px rgba(255,218,107,0.35);
  filter: saturate(1.06) contrast(1.03);
  animation: noteFloat 1200ms cubic-bezier(.22,.61,.36,1) forwards;
  z-index: 7; pointer-events: none;
}
@keyframes noteFloat {
  0%   { transform: translate(-50%,-50%) scale(0.75); opacity: 0; }
  12%  { opacity: 1; }
  85%  { transform: translate(-50%,-90vh) scale(1.08); opacity: 0.98; }
  100% { transform: translate(-50%,-95vh) scale(1.08); opacity: 0; }
}

/* (Opcional) Capa foto-cameo si decides mostrar <img> encima del bgCanvas */
.v-photo {
  position: absolute; inset: 0; z-index: 1; /* debajo de fxCanvas, encima de bgCanvas */
  width: 100%; height: 100%;
  object-fit: cover; object-position: 50% 50%;
  filter: saturate(0.9) contrast(1.04) brightness(0.96);
  mix-blend-mode: screen; /* integra con foco/bokeh */
  opacity: 0; transition: opacity 800ms ease, transform 8s ease;
  transform: scale(1.02); /* Ken Burns leve; JS puede animar */
  pointer-events: none;
}

/* -----------------------------
   4) UI MÍNIMA — BOTÓN INICIAR
   ----------------------------- */
.ui {
  position: absolute; inset: 0; z-index: 10;
  display: grid; place-items: center;
  pointer-events: none; /* sólo el botón debe recibir eventos */
}

.btn-start {
  pointer-events: auto;
  appearance: none; border: 0; border-radius: 999px;
  padding: 0.9rem 1.4rem;
  font-weight: 600; letter-spacing: .02em;
  background: var(--btn-bg);
  color: var(--btn-fg);
  box-shadow:
    0 0 0 2px rgba(255,255,255,0.04) inset,
    0 8px 24px rgba(0,0,0,0.45),
    0 0 0 0 rgba(59,95,180,0); /* ring anim */
  transition: transform 160ms ease, box-shadow 240ms ease, filter 200ms ease;
  filter: drop-shadow(0 6px 18px rgba(36,59,107,0.45));
}
.btn-start:hover {
  transform: translateY(-1px);
  box-shadow:
    0 0 0 2px rgba(255,255,255,0.06) inset,
    0 10px 30px rgba(0,0,0,0.50),
    0 0 0 6px rgba(59,95,180,0.25);
}
.btn-start:active {
  transform: translateY(0);
  box-shadow:
    0 0 0 2px rgba(255,255,255,0.05) inset,
    0 6px 16px rgba(0,0,0,0.45),
    0 0 0 3px rgba(59,95,180,0.35);
}

/* Ocultar UI cuando activo */
body.v-active .ui { display: none; }

/* -----------------------------
   5) ESTADOS DE INTENSIDAD
   ----------------------------- */
/* Primer boost (≈ 2:04) — calienta escena y acelera sutil */
body.v-ramp-1 {
  --v-bright: 1.02;
  --v-zoom:   1.012;
  --v-foco:   0.92;
  --v-speed:  1.08;
}

/* Preclímax (2:20–2:25) — más brillo/zoom, roll a 0° */
body.v-preclimax {
  --v-bright: 1.06;
  --v-zoom:   1.045;
  --v-roll:   0deg;
  --v-foco:   0.98;
  --v-speed:  1.12;
}

/* Boost temporal ligado a movimiento rápido del puntero */
body.v-boost-stars {
  --v-bright: 1.03;
  --v-speed:  1.18;
}

/* -----------------------------
   6) ACCESIBILIDAD / REDUCED MOTION
   ----------------------------- */
@media (prefers-reduced-motion: reduce) {
  .stage {
    transition: none !important;
    transform: none !important;
    filter: brightness(1) contrast(1.02) saturate(1) !important;
  }
  .grain-overlay { animation: none !important; opacity: 0.04; }
  .tap-note { animation-duration: 700ms; }
  .btn-start { transition: none; }
}

/* -----------------------------
   7) RESPONSIVE / FALLBACKS
   ----------------------------- */
@media (max-width: 720px), (max-height: 520px) {
  .v-whisper { top: 16%; }
  .btn-start { padding: 0.8rem 1.1rem; font-weight: 600; }
  .grain-overlay { opacity: calc(var(--v-grain) * 0.9); }
}

/* Seguridad en navegadores antiguos (sin mix-blend-mode) */
@supports not (mix-blend-mode: screen) {
  .v-photo { mix-blend-mode: normal; opacity: 0.72; }
  .flash   { mix-blend-mode: normal; }
}

/* -----------------------------
   8) CONTENEDORES RECOMENDADOS
   ----------------------------- */
/* Estructura mínima en HTML:
  <div class="stage v-vignette">
    <canvas id="bgCanvas"></canvas>
    <img class="v-photo" alt="" aria-hidden="true" />
    <div class="foco-dorado"></div>
    <canvas id="fxCanvas"></canvas>
    <div class="grain-overlay"></div>
    <div class="flash" id="v-flash"></div>
    <div class="v-whisper" id="v-whisper" aria-live="polite"></div>
    <div class="ui"><button class="btn-start" id="btnStart">Iniciar</button></div>
  </div>
*/

/* -----------------------------
   9) UTILIDADES
   ----------------------------- */
.hidden { display: none !important; }
.dim    { opacity: 0.6; transition: opacity 240ms ease; }

body:not(.v-active) #v-constellations,
body:not(.v-active) #v-whispers,
body:not(.v-active) #v-sparkles{
  display: none !important;
}

