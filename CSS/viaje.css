/* =========================================================
   VIAJE — Planetarium ENHANCED (CSS)
   Versión mejorada con efectos visuales espectaculares
   ========================================================= */
*{box-sizing:border-box}
html,body{height:100%;margin:0;padding:0;background:#000;color:#f2efe9}
body{
  font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial,"Noto Sans";
  line-height:1.4;overflow:hidden;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
}

:root{
  --midnight:#050814; --deep:#0a0f1f; --royal:#1e3a8a; --gold:#fbbf24; --lav:#c4b5fd; --ivory:#fef3c7;
  --cyan:#06b6d4; --purple:#a855f7; --pink:#ec4899;
  --v-bright:1.1; --v-zoom:1; --v-roll:0deg; --v-speed:1;
  --v-vignette:1; --v-grain:0.12; --v-foco:1; --v-bokeh:1;
  --whisper-size:clamp(1rem,1.5vw + .8rem,1.6rem);
  --whisper-track:.08em; --whisper-color:var(--ivory);
  --btn-bg:linear-gradient(135deg,#1e3a8a,#7c3aed,#db2777); 
  --btn-fg:#fff;
}

/* Stage + canvases con fondo más profundo */
.stage{
  position:relative;width:100vw;height:100vh;overflow:hidden;
  background:
    radial-gradient(ellipse 140% 100% at 50% 0%, rgba(30,58,138,.45) 0%, rgba(5,8,20,0) 50%),
    radial-gradient(ellipse 120% 80% at 80% 20%, rgba(168,85,247,.25) 0%, rgba(5,8,20,0) 45%),
    radial-gradient(ellipse 140% 100% at 50% 100%, rgba(251,191,36,.15) 0%, rgba(5,8,20,0) 60%),
    radial-gradient(ellipse 100% 80% at 20% 80%, rgba(6,182,212,.18) 0%, rgba(5,8,20,0) 50%),
    linear-gradient(180deg, #000000 0%, #050814 20%, #0a0f1f 50%, #050814 80%, #000000 100%);
  filter:brightness(var(--v-bright)) saturate(1.15) contrast(1.08);
  transform:scale(var(--v-zoom)) rotate(var(--v-roll));
  transform-origin:50% 50%;
  transition:
    filter 500ms cubic-bezier(.22,.61,.36,1),
    transform 800ms cubic-bezier(.22,.61,.36,1),
    opacity 700ms ease;
}

#bgCanvas,#fxCanvas{position:absolute;inset:0;width:100%;height:100%;display:block}
#bgCanvas{z-index:0} 
#fxCanvas{z-index:2;pointer-events:none;mix-blend-mode:screen}

/* Viñeta más dramática */
.v-vignette::after{
  content:"";position:absolute;inset:0;pointer-events:none;mix-blend-mode:multiply;z-index:3;
  opacity:calc(.85 * var(--v-vignette));
  background:radial-gradient(ellipse 110% 80% at 50% 50%, 
    rgba(0,0,0,0) 35%, 
    rgba(0,0,0,.25) 55%, 
    rgba(0,0,0,.45) 75%, 
    rgba(0,0,0,.75) 100%);
  animation:vignetteBreath 8s ease-in-out infinite;
}

@keyframes vignetteBreath{
  0%, 100%{opacity:calc(.85 * var(--v-vignette))}
  50%{opacity:calc(.75 * var(--v-vignette))}
}

/* Foco dorado MUCHO más intenso y animado */
.foco-dorado{
  position:absolute;inset:0;z-index:1;pointer-events:none;opacity:var(--v-foco);
  background:
    radial-gradient(ellipse 130% 60% at 50% -20%,
      rgba(251,191,36,.45) 0%, 
      rgba(251,191,36,.28) 18%, 
      rgba(251,191,36,.15) 30%, 
      rgba(251,191,36,.08) 45%, 
      rgba(251,191,36,0) 65%),
    radial-gradient(circle at 30% 40%, rgba(168,85,247,.12), transparent 40%),
    radial-gradient(circle at 70% 60%, rgba(6,182,212,.10), transparent 35%);
  mix-blend-mode:screen;
  transition:opacity 800ms ease, transform 1500ms cubic-bezier(.22,.61,.36,1);
  transform-origin:50% 0%;
  animation:focoFloat 12s ease-in-out infinite;
}

@keyframes focoFloat{
  0%, 100%{transform:translateY(0) scaleY(1)}
  50%{transform:translateY(3vh) scaleY(1.08)}
}

/* Grano fílmico MEJORADO con más textura */
.grain-overlay{
  position:absolute;inset:0;z-index:4;pointer-events:none;opacity:var(--v-grain);mix-blend-mode:overlay;
  background-image:
    radial-gradient(1.5px 1.5px at 12% 18%, rgba(255,255,255,.18) 20%, transparent 21%),
    radial-gradient(1.8px 1.8px at 88% 42%, rgba(255,255,255,.12) 20%, transparent 21%),
    radial-gradient(1.3px 1.3px at 45% 82%, rgba(255,255,255,.15) 20%, transparent 21%),
    radial-gradient(1.6px 1.6px at 68% 65%, rgba(255,255,255,.10) 20%, transparent 21%),
    radial-gradient(2px 2px at 25% 55%, rgba(251,191,36,.08) 20%, transparent 21%),
    radial-gradient(1.4px 1.4px at 32% 28%, rgba(0,0,0,.35) 20%, transparent 21%),
    radial-gradient(1.7px 1.7px at 75% 25%, rgba(0,0,0,.28) 20%, transparent 21%);
  background-size:120px 120px,150px 150px,135px 135px,165px 165px,180px 180px,195px 195px,210px 210px;
  animation:grainShift 5s steps(80) infinite;
}

@keyframes grainShift{
  0%{transform:translate(0,0)}
  25%{transform:translate(-1.2%,.8%)}
  50%{transform:translate(-2%,1.5%)}
  75%{transform:translate(-1%,1%)}
  100%{transform:translate(0,0)}
}

/* Flash más INTENSO y COLORIDO */
.flash{
  position:absolute;inset:0;z-index:5;pointer-events:none;opacity:0;
  transition:opacity 100ms ease-out;
  background:
    radial-gradient(ellipse 70% 55% at 50% 50%, 
      rgba(255,255,255,.75) 0%,
      rgba(251,191,36,.65) 20%, 
      rgba(251,191,36,.35) 40%, 
      rgba(168,85,247,.15) 60%, 
      rgba(251,191,36,0) 80%);
  mix-blend-mode:screen;
}
.flash.is-on{opacity:1;animation:flashPulse 180ms ease-out}

@keyframes flashPulse{
  0%{opacity:0;transform:scale(.95)}
  40%{opacity:1;transform:scale(1)}
  100%{opacity:1;transform:scale(1.02)}
}

/* Susurros MÁS DRAMÁTICOS con efectos de glow */
.v-whisper{
  position:absolute;left:50%;top:12%;transform:translate(-50%,-50%);
  font-size:var(--whisper-size);
  font-weight:700;
  font-variant-caps:all-small-caps;
  letter-spacing:var(--whisper-track);
  color:var(--whisper-color);
  text-shadow:
    0 0 20px rgba(251,191,36,.85),
    0 0 40px rgba(251,191,36,.55),
    0 0 60px rgba(168,85,247,.45),
    0 0 80px rgba(30,58,138,.35),
    0 2px 8px rgba(0,0,0,.8);
  opacity:0;
  transition:opacity 600ms ease, transform 600ms cubic-bezier(.22,.61,.36,1);
  z-index:6;pointer-events:none;user-select:none;
  filter:drop-shadow(0 0 25px rgba(251,191,36,.6));
}
.v-whisper.show{
  opacity:1;
  transform:translate(-50%,-50%) scale(1.05);
  animation:whisperGlow 2s ease-in-out infinite;
}

@keyframes whisperGlow{
  0%, 100%{
    text-shadow:
      0 0 20px rgba(251,191,36,.85),
      0 0 40px rgba(251,191,36,.55),
      0 0 60px rgba(168,85,247,.45),
      0 0 80px rgba(30,58,138,.35);
  }
  50%{
    text-shadow:
      0 0 30px rgba(251,191,36,1),
      0 0 60px rgba(251,191,36,.75),
      0 0 90px rgba(168,85,247,.65),
      0 0 120px rgba(30,58,138,.45);
  }
}

/* Tap notes MÁS ESPECTACULARES */
.tap-note{
  position:absolute;width:14px;height:14px;border-radius:50%;
  background:
    radial-gradient(circle at 35% 35%, 
      rgba(255,255,255,1) 0%,
      rgba(251,191,36,1) 25%,
      rgba(168,85,247,.8) 50%,
      rgba(251,191,36,0) 75%);
  box-shadow:
    0 0 12px rgba(251,191,36,1),
    0 0 24px rgba(251,191,36,.85),
    0 0 36px rgba(168,85,247,.65),
    0 0 48px rgba(6,182,212,.45);
  filter:saturate(1.3) contrast(1.1) brightness(1.2);
  animation:noteFloat 1400ms cubic-bezier(.22,.61,.36,1) forwards;
  z-index:7;pointer-events:none;
}

@keyframes noteFloat{
  0%{
    transform:translate(-50%,-50%) scale(.6);
    opacity:0;
    filter:blur(2px) saturate(1.3) brightness(1.2);
  }
  15%{
    opacity:1;
    filter:blur(0) saturate(1.4) brightness(1.3);
  }
  85%{
    transform:translate(-50%,-92vh) scale(1.15);
    opacity:1;
    filter:blur(1px) saturate(1.2) brightness(1.1);
  }
  100%{
    transform:translate(-50%,-98vh) scale(1.2);
    opacity:0;
    filter:blur(3px) saturate(1) brightness(1);
  }
}

/* UI con botón ESPECTACULAR */
.ui{
  position:absolute;inset:0;z-index:10;
  display:grid;place-items:center;pointer-events:none;
}

.btn-start{
  pointer-events:auto;appearance:none;border:0;
  border-radius:999px;
  padding:1.1rem 2rem;
  font-size:1.1rem;
  font-weight:700;
  letter-spacing:.05em;
  text-transform:uppercase;
  background:var(--btn-bg);
  color:var(--btn-fg);
  box-shadow:
    0 0 0 3px rgba(255,255,255,.12) inset,
    0 0 30px rgba(168,85,247,.55),
    0 0 50px rgba(251,191,36,.35),
    0 12px 40px rgba(0,0,0,.6);
  transition:all 200ms cubic-bezier(.22,.61,.36,1);
  filter:drop-shadow(0 8px 25px rgba(168,85,247,.5));
  cursor:pointer;
  position:relative;
  overflow:hidden;
  animation:btnPulse 3s ease-in-out infinite;
}

.btn-start::before{
  content:"";
  position:absolute;inset:0;
  background:linear-gradient(135deg, 
    transparent 0%, 
    rgba(255,255,255,.3) 50%, 
    transparent 100%);
  transform:translateX(-100%);
  transition:transform 600ms ease;
}

.btn-start:hover{
  transform:translateY(-2px) scale(1.05);
  box-shadow:
    0 0 0 3px rgba(255,255,255,.2) inset,
    0 0 40px rgba(168,85,247,.75),
    0 0 70px rgba(251,191,36,.55),
    0 0 100px rgba(6,182,212,.35),
    0 16px 50px rgba(0,0,0,.7);
}

.btn-start:hover::before{
  transform:translateX(100%);
}

.btn-start:active{
  transform:translateY(0) scale(1);
  box-shadow:
    0 0 0 2px rgba(255,255,255,.15) inset,
    0 0 25px rgba(168,85,247,.6),
    0 8px 30px rgba(0,0,0,.6);
}

@keyframes btnPulse{
  0%, 100%{
    box-shadow:
      0 0 0 3px rgba(255,255,255,.12) inset,
      0 0 30px rgba(168,85,247,.55),
      0 0 50px rgba(251,191,36,.35),
      0 12px 40px rgba(0,0,0,.6);
  }
  50%{
    box-shadow:
      0 0 0 3px rgba(255,255,255,.18) inset,
      0 0 45px rgba(168,85,247,.75),
      0 0 70px rgba(251,191,36,.55),
      0 0 90px rgba(6,182,212,.25),
      0 12px 40px rgba(0,0,0,.6);
  }
}

body.v-active .ui{display:none}

/* Estados MEJORADOS */
body.v-ramp-1{
  --v-bright:1.15;
  --v-zoom:1.02;
  --v-foco:1.1;
  --v-speed:1.12;
}

body.v-preclimax{
  --v-bright:1.25;
  --v-zoom:1.06;
  --v-roll:0deg;
  --v-foco:1.2;
  --v-speed:1.2;
}

body.v-boost-stars{
  --v-bright:1.18;
  --v-speed:1.25;
}

/* FIN mejorado */
body.v-end .stage{
  filter:brightness(0) contrast(1.05) saturate(.8);
  opacity:1;
  transition:filter 2500ms cubic-bezier(.22,.61,.36,1);
}
body.v-end .v-whisper{opacity:0;transition:opacity 800ms ease}
body.v-end .grain-overlay{opacity:0;transition:opacity 1200ms ease}

/* Reduced motion */
@media (prefers-reduced-motion:reduce){
  .stage{transition:none !important;transform:none !important;filter:brightness(1.05) !important}
  .grain-overlay{animation:none !important;opacity:.06}
  .tap-note{animation-duration:900ms}
  .btn-start{transition:none;animation:none}
  .v-whisper.show{animation:none}
  .foco-dorado{animation:none}
  .v-vignette::after{animation:none}
}

/* Responsive */
@media (max-width:720px),(max-height:520px){
  .v-whisper{top:14%;font-size:clamp(.9rem,1.3vw + .6rem,1.3rem)}
  .btn-start{padding:.95rem 1.6rem;font-size:1rem}
  .grain-overlay{opacity:calc(var(--v-grain)*.85)}
}

/* Optimización móvil */
.stage{backface-visibility:hidden;will-change:transform,filter}
#bgCanvas,#fxCanvas{transform:translateZ(0)}
@media (pointer:coarse){
  .grain-overlay{opacity:calc(var(--v-grain)*.7)}
}

.hidden{display:none !important}
.dim{opacity:.5;transition:opacity 300ms ease}

/* Mensaje sin audio MEJORADO */
.no-audio-msg{
  position:absolute;inset:0;z-index:100;
  background:linear-gradient(135deg, rgba(5,8,20,.98), rgba(10,15,31,.98));
  display:flex;align-items:center;justify-content:center;flex-direction:column;
  color:var(--ivory);padding:2.5rem;text-align:center;gap:1.5rem;
  backdrop-filter:blur(10px);
}
.no-audio-msg.hidden{display:none}
.no-audio-msg p:first-child{
  font-size:1.5rem;font-weight:700;margin:0;
  text-shadow:0 0 20px rgba(251,191,36,.6);
}
.no-audio-msg p:last-of-type{
  font-size:1rem;opacity:.85;margin:0;line-height:1.6;
}
