/* =========================================================
   VIAJE — Planetarium 1:01–2:25 (CSS)
   Estilo: Jazz Noir Minimal
   Capas: bgCanvas (fondo) + fxCanvas (efectos)
   Estados: .v-ramp-1 (≈2:04), .v-preclimax (2:20–2:25)
   Tokens: --v-bright, --v-zoom, --v-roll, --v-speed
   ========================================================= */

/* Reset & base */
* { box-sizing: border-box; }
html, body {
  height: 100%; margin: 0; padding: 0;
  background: #0b0f1d; color: #f2efe9;
}
body {
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI",
               Roboto, "Noto Sans", Arial, "Helvetica Neue";
  line-height: 1.4; overflow: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Paleta y tokens */
:root {
  --midnight:#0b0f1d; --royal:#243b6b; --gold:#ffda6b; --lav:#d7c8ff; --ivory:#f2efe9;

  --v-bright: 1;      /* brillo global 1.00 → 1.06 */
  --v-zoom:   1;      /* zoom global 1.00 → 1.045 */
  --v-roll:   0deg;   /* roll ±0.4° → 0° final */
  --v-speed:  1;      /* escala de velocidad */

  --v-vignette: 1;    /* viñeta 0–1 */
  --v-grain:   0.08;  /* grano 0–0.15 */
  --v-foco:    0.85;  /* foco dorado 0–1 */
  --v-bokeh:   0.9;   /* bokeh 0–1 */

  --whisper-size: clamp(0.8rem, 1.2vw + .5rem, 1.2rem);
  --whisper-track: 0.04em;
  --whisper-color: var(--ivory);

  --btn-bg: linear-gradient(180deg, #1b2442, #0f1630);
  --btn-fg: var(--ivory);
}

/* Stage / canvases */
.stage {
  position: relative; width: 100vw; height: 100vh; overflow: hidden;
  background:
    radial-gradient(120% 85% at 50% 15%, rgba(36,59,107,.35) 0%, rgba(11,15,29,0) 45%),
    radial-gradient(120% 85% at 50% 85%, rgba(255,218,107,.10) 0%, rgba(11,15,29,0) 55%),
    var(--midnight);
  filter: brightness(var(--v-bright)) saturate(1.02) contrast(1.04);
  transform: scale(var(--v-zoom)) rotate(var(--v-roll));
  transform-origin: 50% 50%;
  transition:
    filter 400ms cubic-bezier(.22,.61,.36,1),
    transform 600ms cubic-bezier(.22,.61,.36,1);
}
#bgCanvas, #fxCanvas {
  position: absolute; inset: 0;
  width: 100%; height: 100%; display: block;
}
#bgCanvas { z-index: 0; }
#fxCanvas { z-index: 2; pointer-events: none; }

/* Viñeta cine */
.v-vignette::after {
  content: "";
  position: absolute; inset: 0; pointer-events: none;
  mix-blend-mode: multiply; z-index: 3;
  opacity: calc(0.75 * var(--v-vignette));
  background: radial-gradient(ellipse 120% 85% at 50% 50%,
    rgba(0,0,0,0) 50%, rgba(0,0,0,.35) 75%, rgba(0,0,0,.62) 100%);
}

/* Foco dorado elíptico */
.foco-dorado {
  position: absolute; inset: 0; z-index: 1; pointer-events: none;
  opacity: var(--v-foco);
  background: radial-gradient(120% 55% at 50% -15%,
    rgba(255,218,107,.25) 0%,
    rgba(255,218,107,.14) 22%,
    rgba(255,218,107,.08) 35%,
    rgba(255,218,107,0) 60%);
  transition: opacity 600ms ease, transform 1200ms cubic-bezier(.22,.61,.36,1);
  transform-origin: 50% 0%;
}

/* Grano fílmico sutil */
.grain-overlay {
  position: absolute; inset: 0; z-index: 4; pointer-events: none;
  opacity: var(--v-grain); mix-blend-mode: overlay;
  background-image:
    radial-gradient(1.2px 1.2px at 8% 12%, rgba(255,255,255,.12) 20%, transparent 21%),
    radial-gradient(1.4px 1.4px at 82% 33%, rgba(255,255,255,.08) 20%, transparent 21%),
    radial-gradient(1.1px 1.1px at 41% 77%, rgba(255,255,255,.10) 20%, transparent 21%),
    radial-gradient(1.3px 1.3px at 63% 58%, rgba(255,255,255,.06) 20%, transparent 21%),
    radial-gradient(1.2px 1.2px at 25% 45%, rgba(0,0,0,.25) 20%, transparent 21%),
    radial-gradient(1.3px 1.3px at 70% 20%, rgba(0,0,0,.18) 20%, transparent 21%);
  background-size: 140px 140px, 160px 160px, 150px 150px, 180px 180px, 200px 200px, 220px 220px;
  animation: grainShift 6s steps(60) infinite;
}
@keyframes grainShift {
  0% { transform: translate(0,0); }
  50%{ transform: translate(-1.5%, 1%); }
  100%{ transform: translate(0,0); }
}

/* Flash breve */
.flash {
  position: absolute; inset: 0; z-index: 5; pointer-events: none;
  opacity: 0; transition: opacity 120ms ease-out;
  background: radial-gradient(65% 50% at 50% 50%,
    rgba(255,245,225,.55),
    rgba(255,218,107,.45) 32%,
    rgba(255,218,107,.15) 52%,
    rgba(255,218,107,0) 70%);
  mix-blend-mode: screen;
}
.flash.is-on { opacity: 1; }

/* Susurros (1–2 palabras) */
.v-whisper {
  position: absolute; left: 50%; top: 14%;
  transform: translate(-50%, -50%);
  font-size: var(--whisper-size);
  font-variant-caps: all-small-caps;
  letter-spacing: var(--whisper-track);
  color: var(--whisper-color);
  text-shadow:
    0 0 12px rgba(0,0,0,.40),
    0 0 28px rgba(0,0,0,.55),
    0 0 42px rgba(36,59,107,.35);
  opacity: 0; transition: opacity 450ms ease;
  z-index: 6; pointer-events: none; user-select: none;
}
.v-whisper.show { opacity: .92; }

/* Nota/estrella decorativa en tap/click */
.tap-note {
  position: absolute; width: 10px; height: 10px; border-radius: 50%;
  background: radial-gradient(circle at 40% 40%, var(--gold), rgba(255,218,107,0) 70%);
  box-shadow:
    0 0 8px rgba(255,218,107,.85),
    0 0 18px rgba(215,200,255,.60),
    0 0 32px rgba(255,218,107,.35);
  filter: saturate(1.06) contrast(1.03);
  animation: noteFloat 1200ms cubic-bezier(.22,.61,.36,1) forwards;
  z-index: 7; pointer-events: none;
}
@keyframes noteFloat {
  0%   { transform: translate(-50%,-50%) scale(.75); opacity: 0; }
  12%  { opacity: 1; }
  85%  { transform: translate(-50%,-90vh) scale(1.08); opacity: .98; }
  100% { transform: translate(-50%,-95vh) scale(1.08); opacity: 0; }
}

/* UI mínima */
.ui {
  position: absolute; inset: 0; z-index: 10;
  display: grid; place-items: center;
  pointer-events: none;
}
.btn-start {
  pointer-events: auto;
  appearance: none; border: 0; border-radius: 999px;
  padding: .9rem 1.4rem;
  font-weight: 600; letter-spacing: .02em;
  background: var(--btn-bg); color: var(--btn-fg);
  box-shadow:
    0 0 0 2px rgba(255,255,255,.04) inset,
    0 8px 24px rgba(0,0,0,.45);
  transition: transform 160ms ease, box-shadow 240ms ease, filter 200ms ease;
  filter: drop-shadow(0 6px 18px rgba(36,59,107,.45));
}
.btn-start:hover {
  transform: translateY(-1px);
  box-shadow:
    0 0 0 2px rgba(255,255,255,.06) inset,
    0 10px 30px rgba(0,0,0,.50),
    0 0 0 6px rgba(59,95,180,.25);
}
.btn-start:active {
  transform: translateY(0);
  box-shadow:
    0 0 0 2px rgba(255,255,255,.05) inset,
    0 6px 16px rgba(0,0,0,.45),
    0 0 0 3px rgba(59,95,180,.35);
}
body.v-active .ui { display: none; }

/* Estados de intensidad */
body.v-ramp-1 {
  --v-bright: 1.02; --v-zoom: 1.012; --v-foco: .92; --v-speed: 1.08;
}
body.v-preclimax {
  --v-bright: 1.06; --v-zoom: 1.045; --v-roll: 0deg; --v-foco: .98; --v-speed: 1.12;
}
body.v-boost-stars {
  --v-bright: 1.03; --v-speed: 1.18;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .stage {
    transition: none !important;
    transform: none !important;
    filter: brightness(1) contrast(1.02) saturate(1) !important;
  }
  .grain-overlay { animation: none !important; opacity: .04; }
  .tap-note { animation-duration: 700ms; }
  .btn-start { transition: none; }
}

/* Responsive */
@media (max-width: 720px), (max-height: 520px) {
  .v-whisper { top: 16%; }
  .btn-start { padding: .8rem 1.1rem; }
  .grain-overlay { opacity: calc(var(--v-grain) * .9); }
}

/* Parche tearing móvil y aceleración de capas */
.stage { backface-visibility: hidden; will-change: transform, filter; }
#bgCanvas, #fxCanvas { transform: translateZ(0); }
@media (pointer: coarse) { .grain-overlay { display: none !important; } }

/* Utilidades */
.hidden { display: none !important; }
.dim    { opacity: .6; transition: opacity 240ms ease; }


